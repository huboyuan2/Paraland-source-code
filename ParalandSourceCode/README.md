## 项目名称
>纵与横之地 

项目类型：鸿蒙平台创意游戏

项目组名：Fine Game 纯粹游戏

项目成员:胡博源 任晓宇


## 运行条件&运行说明
本示例在团结引擎1.0.4与DevEco Studio 4.0 Release环境下开发完成，仅支持API version 10版本SDK进行构建
，构建好的hap文件在鸿蒙系统下直接安装运行即可游玩
游戏主场景为：\Assets\Scenes\SampleScene.unity


## 游戏演示视频
 [游戏演示视频](./demoPlay.mp4)


## 游戏安装文件
 [游戏安装文件](./paraland.hap)



## 设计理念
>游戏的诞生源自于我的一次偶然的思考：如果将《魔塔》的固定数值RPG玩法和类似《纪念碑谷》的视错觉解谜玩法相结合是否会很有趣。《纪念碑谷》对艾舍尔笔下“不可能建筑”和“不可能几何图形”的极致美学追求并非我可以望其项背，于是我决定转变设计思路，允许玩家旋转视角，并将地图设计成一个足够立体且每个区域在特定视角下相互连接的类银河恶魔城式3d箱庭地图。玩家每次旋转视角都会发现原本不相邻甚至相隔很远的的地块在这个视角下连接到了一起，形成了很多近路，从而享受探索的乐趣，同时在类似《魔塔》固定数值RPG玩法中规划最优的打怪升级路线，获取最大收益。两种玩法有机结合，带给玩家1+1>2的乐趣。



## 技术难点
>1.等距视角下考虑视错觉玩法的寻路算法。由于本游戏需要实现“在特定视角下看上去相邻的地块都可以走到”，所以团结引擎自带的NavMesh寻路和原始的A Star寻路算法难以满足游戏需求，我需要自己写一套寻路算法。我写的寻路算法大体上还是遵循A Star的思路。每个地块对应一个寻路节点。每个节点需要计算到起点和终点的曼哈顿距离并排序，将距离最小的的节点存入闭区间，其余节点存入开区间，并在走进死胡同时根据开区间和闭区间进行回溯。比较特别的是，由于涉及到上下楼梯，栏杆等较为复杂的情况，本游戏并没有事先将四个视角下地块的排列情况序列化好，而是每一次递归寻路都使用射线检测的方法判断出当前地块在当前视角下视觉上相邻的地块。这样做的好处是在遇到楼梯，栏杆，以及可能导致视觉上穿帮的地块遮挡关系时可以具体问题具体分析。此外，由于本作存在大量视错觉玩法，在玩家运动的过程中，我们也使用了一些“障眼法”来避免视觉上的穿帮，比如偷偷将玩家瞬移到一个对应相同屏幕位置但离相机距离不同的点。

2.利用DevEco Studio配合团结引擎进行开发，对鸿蒙系统适配构建hap游戏包，利用hdc工具进行游戏调试；针对游戏关卡玩法模块与非玩法模块的再序列化构筑，把游戏方块元素再模块化，实现关卡内容JSON序列化，为以后关卡编辑器与存档读档系统提供基础。

3.其余如对话，道具，战斗等系统的实现相对比较随意，所有的配置表都使用ScriptableObject实现，方便在游戏引擎中快速编辑。

4.图形渲染：
为了营造游戏氛围，我们计划实现“海拔越低，雾气越浓”的高度雾效果。本项目中我们实现了两套高度雾的解决方案。第一套方案是在不透明渲染队列和透明渲染队列之间增加一个的用于全屏绘制雾效的CommandBuffer,在其Shader中根据像深度图进行一系列复杂的矩阵运算还原出每个像素点的世界空间坐标，根据每个像素点世界坐标的y轴高度计算雾气的浓度。这套方案的好处是能将其他与世界空间坐标相关的特效比如扫描特效一并实现，缺点是GPU计算量较大，在手机上稍微有点奢侈。第二套方案是在场景中放置一个巨大的水平面片，视其为高度雾区域的上表面。将其渲染队列设置为透明队列。在这个面片的shader中计算面片的深度与从深度图中取出的面片后方模型的深度的差值。并根据计算结果设置面片当前像素透明度。由于面片是水平的，相机是倾斜向下拍摄的，所以面片下方模型高度越低，差值越大，从而实现了“海拔越低，雾气越浓”的效果。


## 协作者&特别感谢
> 吴帅奇 ——宣传视频制作